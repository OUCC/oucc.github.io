---
import type { ImageMetadata } from 'astro'
import type { CollectionEntry } from 'astro:content'
import defaultImage from '@/assets/avatar.svg'
import Image from '@/components/common/Image.astro'
import { unreachable } from '@/utils/unreachable'
import { getAuthorIcon } from './getAuthorIcon'

interface Props {
  author: CollectionEntry<'authors'>
  size: number
}

const { author, size } = Astro.props

const getSrc = async (): Promise<string | ImageMetadata> => {
  const icon = await getAuthorIcon(author)
  switch (icon.type) {
    case 'local-svg':
      return icon.imageMetadata
    case 'local-png':
      return icon.imageMetadata
    case 'external-url':
      return icon.url
    case 'default':
      return defaultImage
    default:
      return unreachable(icon)
  }
}
---

<Image
  src={await getSrc()}
  alt={`${author.data.name} のアイコン`}
  class="aspect-square rounded-full"
  width={size}
  height={size}
/>
