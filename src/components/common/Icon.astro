---
import { optimize } from 'svgo'

interface Props {
  // `src/assets/icons`にあるSVGのファイル名
  name: string

  // `aria-label`に指定するテキスト
  alt: string

  isBlog?: boolean
  class?: string

  width?: number
  height?: number
}

const { name, alt, isBlog, width, height, ...attrs } = Astro.props

const normalizedAttrs: Partial<
  Record<Exclude<keyof Props, 'name' | 'alt'>, string>
> = attrs

if (width) normalizedAttrs.width = width.toString()
if (height) normalizedAttrs.height = height.toString()

const svgContent = isBlog
  ? (await import(`../../assets/icons/blog/${name}.svg?raw`)).default
  : (await import(`../../assets/icons/${name}.svg?raw`)).default

const { data: optimizedSvgContent } = optimize(svgContent, {
  plugins: [
    {
      name: 'preset-default',
      params: {
        overrides: {
          convertPathData: false,
          removeViewBox: false,
        },
      },
    },
    'removeDimensions',
    {
      name: 'addAttributesToSVGElement',
      params: {
        attribute: {
          role: 'img',
          'aria-label': alt,
          ...normalizedAttrs,
        },
      },
    },
  ],
})
---

<Fragment set:html={optimizedSvgContent} />
