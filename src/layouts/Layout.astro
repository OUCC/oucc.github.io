---
import type {
  BreadcrumbList,
  Organization,
  WebSite,
  WithContext,
} from 'schema-dts'
import Header from '@/components/nav/Header.astro'
import Footer from '@/components/Footer.astro'
import StructuredData from '@/components/StructuredData.astro'

export interface Props {
  title?: string
  description: string
  showJoinLink?: boolean
}

if (Astro.site === undefined) {
  throw new Error('Astro.siteが未定義です。astro.config.tsで設定してください。')
}

const { title, description, showJoinLink = false } = Astro.props

const canonicalURL = new URL(Astro.url.pathname, Astro.site)
const logoUrl = new URL('/favicon.webp', Astro.site)

const composedTitle =
  title === undefined
    ? 'OUCC - 大阪大学コンピュータークラブ'
    : title + ' | OUCC - 大阪大学コンピュータークラブ'
---

<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    <meta name="description" content={description} />
    <link rel="canonical" href={canonicalURL} />
    <link rel="icon" href="/favicon.webp" />
    <title>{composedTitle}</title>
  </head>
  <body class="min-h-screen flex flex-col">
    <Header showJoinLink={showJoinLink} />
    <div class="flex-grow">
      <slot />
    </div>
    <Footer />
    <StructuredData
      data={{
        '@context': 'https://schema.org',
        '@type': 'WebSite',
        name: 'OUCC - 大阪大学コンピュータークラブ',
        alternateName: 'OUCC',
        url: Astro.site.toString(),
      } satisfies WithContext<WebSite>}
    />
    <StructuredData
      data={{
        '@context': 'https://schema.org',
        '@type': 'Organization',
        logo: logoUrl.toString(),
        url: Astro.site.toString(),
      } satisfies WithContext<Organization>}
    />
    {
      title !== undefined && (
        <StructuredData
          data={
            {
              '@context': 'https://schema.org',
              '@type': 'BreadcrumbList',
              itemListElement: [
                {
                  '@type': 'ListItem',
                  position: 1,
                  name: title,
                  item: canonicalURL.toString(),
                },
              ],
            } satisfies WithContext<BreadcrumbList>
          }
        />
      )
    }
  </body>
</html>
<style is:global>
  html {
    /* 参考: https://ics.media/entry/200317/ */
    font-family: 'Helvetica Neue', Arial, 'Hiragino Kaku Gothic ProN',
      'Hiragino Sans', Meiryo, sans-serif;
  }
</style>
